import "dotenv/config";
import OpenAi from "openai";
import { config } from "./config";

const client = new OpenAi({ apiKey: config.openai.key });

async function cleanUpTranscription(transcript: string) {
  const result = await client.chat.completions.create({
    model: "gpt-4",
    temperature: 0,
    messages: [
      {
        role: "system",
        content:
          "You are a helpful assistant. Your task is to correct any spelling discrepancies in the transcribed text in Russian language. Break the text in paragraphs when needed. Only add necessary punctuation such as periods, commas, and capitalization, and use only the context provided.",
      },
      {
        role: "user",
        content: transcript,
      },
    ],
  });

  return result.choices[0]?.message.content ?? "";
}

async function main() {
  // Open an audio file using fs creating a File instance
  // const stream = fs.createReadStream("/Users/dmitru/test-ru-small.mp3");
  // const transcript = await client.audio.transcriptions.create({
  //   file: stream,
  //   model: "whisper-1",
  // });

  const transcript = `Дима, привет. По поводу слоев и по поводу музыка, которая сама понимает, что она музыка. Со смыслами и слоями, что я имею в виду. Я, например, именно альбомы разберу. Какая, в частности, была идея. Одна из идей. Ну вот, например, ты послушал альбом, и тут ты сам пишешь, что это как разные миры, что там много всего происходит. И идея такая, что в общем этот альбом не должен восприниматься как... Точнее, не то, что не должен, а он может восприниматься как именно... Не то, что трек, например, стилистика техно. И второй трек техно. А это именно работы, которые сами про себя понимают, что это как будто музыкальная работа. И общее именно впечатление при прослушивании, что это именно просто многослойная вещь. Даже если композиция простая, сама по своей структуре, как первый трек, как раз клип, на который я прислал, то в сочетании с другими элементами она становится сама одним из слоев альбома. То есть альбом, по сути, это не только сборник отдельных работ, 13 работ, но по сути альбом — это и есть совокупность впечатлений от этих композиций. Но так как они сами по себе устроены иногда просто, иногда специально сложно, то это создает, на мой взгляд, я слышу, что так считывается тоже, что такой вот эффект, что это такая полистеличность. Но полистеличность не просто в каждом треке, а в каждом слое восприятия. И мне кажется, что такой вариант, сейчас, во всяком случае, я так музыку вижу, много музыки, что мне мало, например, просто уже написать какую-то работу. Вот, например, работа, вот пэд, вот там типа ударная. Ну окей, хорошо. Но что еще можно сделать? Вот для работы со слоями конкретно, если мы говорим вот с восприятием. Вот, например, 10 трек «Элементал». Да, вот он идет, он развивается. И вот там вот эта пафосная такая симфоническая история. И она потом в какой-то момент, на второй минуте, она обрывается. Обрывается, потом спохватывается и продолжает. И вот этот вот обрыв, вот эта мелодия демонстрирует слушателю, что композиция, она прекрасно понимает, что это, например, пафосно. И она специально делает такой реверанс, пропадает именно так картина. То есть она обрывается именно картина. Не просто фейд-аутом, да? Ну, если как-то красиво уберем. А вот именно она резко убирается. И потом она опять, вот эта мелодия возникает. Вот эта пафосность, она становится более аккуратной, более скромной. И можно сказать, ну блин, ну не знаю, а почему нельзя просто писать? Почему нельзя просто писать трек? Можно, конечно, писать просто трек. Естественно, все нормально. Вот. И есть работы, которые только от этого выигрывают. То есть мне кажется, что это, знаешь, как вот, почему вот появилась там современная музыка. Можно же писать, вот как вот Бетховен писал, да? Или как Моцарт писал. Конечно, можно. И так и пишут. Но это вопрос просто некоторого творческого исследования. Потому что, грубо говоря, когда некоторые задачи уже решены в музыке, или, давай так скажем, не решены задачи, а просто исследованы вот какие-то территории, то хочется попробовать еще что-то. Вот. А когда средства выражения, они уже исследованы, то, соответственно, у человека просто естественное желание просто попробовать еще что-то сделать. Этот ход, опять же, это не то, что ой, вот какая там эта новая вещь, это же типа модерн-постмодерн. Вот это, да, цитирование и прочее. Да, но мне кажется, ну вот что мне нравится, да, что, ну конкретно я могу про свою работу говорить, потому что это самое адекватное, да? То есть не просто абстрактно рассуждаю про чужое, а про свое. Там нет иронии. Вот для постмодерна очень характерна ирония, вот эта шутейка, да, такая, что, а вот здесь вот вам будет смешно, вот здесь так вот. И мне этого не хотелось сделать. Мне хотелось сделать серьезную работу, действительно, как бы работа мысли, работа вдумчивая, да, которая направлена на различное количество эмоциональных слоев человека, вот, и технически тоже какие-то элементы решить, но там нет иронии. Вот в чем кайф. Там нет вот этого, вот этого хохотейничка, знаешь, такого вот смешарика, который постоянно прикалывает. То есть он сделал такой хихи-хихи, вот видите, как вот мы сделали. И вот это вот, мне кажется, важное отличие. То есть музыка, которая понимает, что она музыка, из-за этого она становится менее пафосной, но при этом ее пафос остается, да? То есть вот эта симфоническая часть элементала, она все равно работает. Просто для тех, кто, ну, как бы это считывать, может считать тоже, как это, не то, что только для избранных, да, кто считает, а просто кто считает, он, он просто улыбнется, говорит, да, хорошо, здорово. Вот, и это просто вот мой способ такой взаимодействия с музыкой. И, опять же, количество слоев, то есть все равно в треке, даже на самом деле в простых треках, вот, а в первом, еще в каких-то там, в рамках альбомов, там на самом деле миллион слоев различных, там очень много. Они просто выглядят вот так вот, они сделаны как бы с простыми, да, но при этом там много слоев. И вот это вот тоже в том числе, о чем я говорю, когда имею в виду большое количество слоев. Поэтому вот про музыку, мне кажется, вот такой подход к музыке, да, он, он может быть интересным. Но тут вот что очень важно. Я не уверен, что это можно делать специально, да, то есть это должно, грубо говоря, прорастать. То есть если у человека появляется вот такая идея, то значит оно проросло. То есть это не то, что, это не как хук, да, какой-то, который можно использовать. То есть можно это, грубо говоря, свою систему загрузить как одну из опций, да, но использовать именно, когда внутри действительно есть некоторая потребность. И я эту штуку применял просто потому, что у меня естественная потребность была сделать вот такие вещи. Просто мне вот немножко тесновато. И опять же это связано с тем, что, с вот этой идеей, что это я слушаю трек, да, например. Если он, грубо говоря, просто хороший трек, ну как бы дальше он для меня не работает. И тут тоже, конечно, вот на каждую вот эту историю можно тоже очень много приводить контраргументов, что, ой, что это нужно тогда постоянно делать, да, или, ну естественно нет. Я просто пытаюсь как бы сам с собой полемизировать и предполагать какой может быть контраргумент, да, на ту вещь. Поэтому просто, грубо говоря, так всего много в музыке сделано, что для меня казалось уместным тоже думать про то, что музыка уже понятна, что вот музыка, гитарная музыка. Вот, да, вот, собственно, ты сейчас скидываешь, да, вот это очень хороший пример искусственный интеллект. Ну вот, да, как бы он сделал джаз, например, какой-то, да, вот он сделал, например, техномузыку. И, ну, в некоторых случаях, если, ну, когда его там натренируют, да, уже там будет удаваться убедительно. А что тогда, да, остается? Ну, допустим, они убедительно сделали, а тогда остается игра как бы с концепциями, с мыслями. Конечно, можно искусственный интеллект тоже натренировать, да, что вот там сделаю концепциональный альбом, но тогда, ну, это мне кажется немножко уже сложнее, то есть он должен принимать какие-то решения более сложно, опираясь на огромное количество музыки, на какой-то вкус и, ну, в общем, то есть это наверняка, наверное, можно тоже сделать, но вот мне вот так вот хотелось сделать. Поэтому я надеюсь более-менее удалось эту идею донести. Первая часть, наверное, была не совсем такая чёткая, но я надеюсь, что ты понял. А если ты не понял, пожалуйста, тоже скажи или, может быть, какие-то элементы, может ты не согласен, да, или, может быть, есть какой-то тоже комментарий, ты напиши, я с радостью тоже почётче сформулирую, вот, но вкратце, да, это вот то, что мне кажется сейчас интересно, но опять же, например, фортепиано я работаю, да, вот я сейчас пишу, но там совсем другая задача, я не, я вот туда не иду, у меня просто как бы инструментарий другой, да, у меня просто вот одно фортепиано и вот нужно вот прям задачу, да, что-то придумать, там я работаю по-другому. Ну, просто мне кажется, вот, современная вот эта техника, да, современная электроакустика, на чём хорошо, потому что ты можешь имплементировать фактически всё, что только есть на земле, VST, аналоговые синты, фортепиано, живой инструмент, акустический, не акустический, и опять же делать это не из-за того, что ты вот так вот, вот, вот прям вот всего, чтобы побольше было, чтобы было вот так вот радостно, чтобы праздничное, а просто потому, что ты используешь очень большую палитру выражений, самовыражений, но при этом, конечно же, дальше стоит на этом фильтр, который впускает или не впускает, как вот я иногда говорю, что гораздо важнее не применять всё, а не применять всё, да, вот, вот это важнейшее, мне кажется, изумение вообще музыканта, то есть не применять всё, а не применять всё, вот, уметь вот это вот отсекать большую часть вещей, которые для конкретной задачи не нужны, то есть ты их знаешь, ты знаешь, что они есть, но ты их не используешь, потому что нет такой задачи, да, а вот обычно используют всё, когда как раз вот в начале исследования находится, вот, поэтому вот это, вот это, мне кажется, момент тоже имеет смысл изучить, то есть можно, то есть это просто как элемент фактической композиции нужно рассматривать, да, музыкой, которая себя воспринимает как не музыку, и из-за этого, опять же, что получается у нас, глубина, да, то есть мы делаем вот эти вещи, и у композиции, ну, в идеальном случае получается ещё один слой, да, смысловой, например, да, а этот смысловой слой, если мы его делаем, он же, ну, если мы выражаем его ещё в звуке, да, мы физически делаем, например, несколько слоёв, да, оно не просто тонкие, то это и в музыке тоже создаёт глубину, получается уже, видишь, такая трёхмерная история, вот, собственно, о чём я говорю.`;

  const cleanedUpTranscript = await cleanUpTranscription(transcript);
  console.log(cleanedUpTranscript);
}

await main();
console.log("bye");
